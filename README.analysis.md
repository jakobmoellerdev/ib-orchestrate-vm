# Analysis of IBU / Recert change impacts

You can view general information about the IBU / Recert changes in the [README.md](README.md) file. 

This version of the repo is customized to contain more measurement methodologies that help analyzing the impact of recert/ibu changes.

For changing core openshift components, there is a dedicated guide in the [openshift dev docs](https://github.com/openshift/enhancements/blob/master/dev-guide/operators.md#how-can-i-test-changes-to-an-openshift-operatoroperandrelease-component)

New Makefile targets have been added to the Makefile to help with the analysis of the recert/ibu changes.

## Makefile targets

### `make recert`

This target will rebuild the recert image and use it in the SeedGen CR to recertify the seed cluster.

### `make cvo-disable`

This target will disable the ClusterVersionOperator in the seed cluster.
This is useful when you want to test the recert/ibu changes without the CVO interfering with your image overrides.

### `make cluster-authentication-operator` and `deploy-cluster-authentication-operator` 

The first target will build the ClusterAuthenticationOperator image and use it in the Seed cluster to test the recert/ibu changes when also changing the operator.
It is just one sample operator to work with, any core operator can work for this.
The second target will deploy the ClusterAuthenticationOperator in the seed cluster (and automatically disable cvo to avoid overrides)

### `make audit-logs`

This target will download the audit logs from the target cluster.

### `make generate-timeline-graph`

This target will generate a timeline graph from the audit logs which will give insight into rollout behavior

### `make start-timeline-graph`

This target will start a python HTTP server to view the timeline graph generated by the previous target. It also opens chrome to view the graph.


## Preparing a consistent runtime environment

It is ideal to include a .env file in the repo for all your tests so that all your runs are consistent. We used the following:

```.dotenv
SEED_IMAGE=quay.io/jmoller/ostbackup:seed
PULL_SECRET=<YOUR PULL SECRET>
BACKUP_SECRET=<QUAY SECRET FOR PUSHING THE SEED IMAGE>
LCA_IMAGE=quay.io/openshift-kni/lifecycle-agent-operator:latest
LCA_GIT_BRANCH=main
SEED_VERSION=4.15.2
TARGET_VERSION=4.14.14
RECERT_IMAGE=<YOUR RECERT IMAGE, e.g. quay.io/jmoller/recert:latest, built on demand>
CLUSTER_AUTHENTICATION_OPERATOR_IMAGE=<YOUR CAO IMAGE, built on demand, e.g quay.io/jmoller/cluster-authentication-operator:latest>
```